/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
import { __awaiter, __generator } from "tslib";
/** Loads and validates the merge configuration. */
export function loadAndValidateConfig(config, api) {
    return __awaiter(this, void 0, void 0, function () {
        var mergeConfig, errors;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    if (config.merge === undefined) {
                        return [2 /*return*/, { errors: ['No merge configuration found. Set the `merge` configuration.'] }];
                    }
                    if (typeof config.merge !== 'function') {
                        return [2 /*return*/, { errors: ['Expected merge configuration to be defined lazily through a function.'] }];
                    }
                    return [4 /*yield*/, config.merge(api)];
                case 1:
                    mergeConfig = _a.sent();
                    errors = validateMergeConfig(mergeConfig);
                    if (errors.length) {
                        return [2 /*return*/, { errors: errors }];
                    }
                    return [2 /*return*/, { config: mergeConfig }];
            }
        });
    });
}
/** Validates the specified configuration. Returns a list of failure messages. */
function validateMergeConfig(config) {
    var errors = [];
    if (!config.labels) {
        errors.push('No label configuration.');
    }
    else if (!Array.isArray(config.labels)) {
        errors.push('Label configuration needs to be an array.');
    }
    if (!config.claSignedLabel) {
        errors.push('No CLA signed label configured.');
    }
    if (!config.mergeReadyLabel) {
        errors.push('No merge ready label configured.');
    }
    if (config.githubApiMerge === undefined) {
        errors.push('No explicit choice of merge strategy. Please set `githubApiMerge`.');
    }
    return errors;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vZGV2LWluZnJhL3ByL21lcmdlL2NvbmZpZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0dBTUc7O0FBcUZILG1EQUFtRDtBQUNuRCxNQUFNLFVBQWdCLHFCQUFxQixDQUN2QyxNQUFvQyxFQUNwQyxHQUFpQjs7Ozs7O29CQUNuQixJQUFJLE1BQU0sQ0FBQyxLQUFLLEtBQUssU0FBUyxFQUFFO3dCQUM5QixzQkFBTyxFQUFDLE1BQU0sRUFBRSxDQUFDLDhEQUE4RCxDQUFDLEVBQUMsRUFBQztxQkFDbkY7b0JBRUQsSUFBSSxPQUFPLE1BQU0sQ0FBQyxLQUFLLEtBQUssVUFBVSxFQUFFO3dCQUN0QyxzQkFBTyxFQUFDLE1BQU0sRUFBRSxDQUFDLHVFQUF1RSxDQUFDLEVBQUMsRUFBQztxQkFDNUY7b0JBRW1CLHFCQUFNLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUE7O29CQUFyQyxXQUFXLEdBQUcsU0FBdUI7b0JBQ3JDLE1BQU0sR0FBRyxtQkFBbUIsQ0FBQyxXQUFXLENBQUMsQ0FBQztvQkFFaEQsSUFBSSxNQUFNLENBQUMsTUFBTSxFQUFFO3dCQUNqQixzQkFBTyxFQUFDLE1BQU0sUUFBQSxFQUFDLEVBQUM7cUJBQ2pCO29CQUVELHNCQUFPLEVBQUMsTUFBTSxFQUFFLFdBQVcsRUFBQyxFQUFDOzs7O0NBQzlCO0FBRUQsaUZBQWlGO0FBQ2pGLFNBQVMsbUJBQW1CLENBQUMsTUFBNEI7SUFDdkQsSUFBTSxNQUFNLEdBQWEsRUFBRSxDQUFDO0lBQzVCLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFO1FBQ2xCLE1BQU0sQ0FBQyxJQUFJLENBQUMseUJBQXlCLENBQUMsQ0FBQztLQUN4QztTQUFNLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRTtRQUN4QyxNQUFNLENBQUMsSUFBSSxDQUFDLDJDQUEyQyxDQUFDLENBQUM7S0FDMUQ7SUFDRCxJQUFJLENBQUMsTUFBTSxDQUFDLGNBQWMsRUFBRTtRQUMxQixNQUFNLENBQUMsSUFBSSxDQUFDLGlDQUFpQyxDQUFDLENBQUM7S0FDaEQ7SUFDRCxJQUFJLENBQUMsTUFBTSxDQUFDLGVBQWUsRUFBRTtRQUMzQixNQUFNLENBQUMsSUFBSSxDQUFDLGtDQUFrQyxDQUFDLENBQUM7S0FDakQ7SUFDRCxJQUFJLE1BQU0sQ0FBQyxjQUFjLEtBQUssU0FBUyxFQUFFO1FBQ3ZDLE1BQU0sQ0FBQyxJQUFJLENBQUMsb0VBQW9FLENBQUMsQ0FBQztLQUNuRjtJQUNELE9BQU8sTUFBTSxDQUFDO0FBQ2hCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgR29vZ2xlIExMQyBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzIGdvdmVybmVkIGJ5IGFuIE1JVC1zdHlsZSBsaWNlbnNlIHRoYXQgY2FuIGJlXG4gKiBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlIGF0IGh0dHBzOi8vYW5ndWxhci5pby9saWNlbnNlXG4gKi9cblxuaW1wb3J0IHtHaXRDbGllbnRDb25maWcsIE5nRGV2Q29uZmlnfSBmcm9tICcuLi8uLi91dGlscy9jb25maWcnO1xuaW1wb3J0IHtHaXRodWJDbGllbnR9IGZyb20gJy4uLy4uL3V0aWxzL2dpdC9naXRodWInO1xuXG5pbXBvcnQge0dpdGh1YkFwaU1lcmdlU3RyYXRlZ3lDb25maWd9IGZyb20gJy4vc3RyYXRlZ2llcy9hcGktbWVyZ2UnO1xuXG4vKiogRGVzY3JpYmVzIHBvc3NpYmxlIHZhbHVlcyB0aGF0IGNhbiBiZSByZXR1cm5lZCBmb3IgYGJyYW5jaGVzYCBvZiBhIHRhcmdldCBsYWJlbC4gKi9cbmV4cG9ydCB0eXBlIFRhcmdldExhYmVsQnJhbmNoUmVzdWx0ID0gc3RyaW5nW118UHJvbWlzZTxzdHJpbmdbXT47XG5cbi8qKlxuICogUG9zc2libGUgbWVyZ2UgbWV0aG9kcyBzdXBwb3J0ZWQgYnkgdGhlIEdpdGh1YiBBUEkuXG4gKiBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3YzL3B1bGxzLyNtZXJnZS1hLXB1bGwtcmVxdWVzdC1tZXJnZS1idXR0b24uXG4gKi9cbmV4cG9ydCB0eXBlIEdpdGh1YkFwaU1lcmdlTWV0aG9kID0gJ21lcmdlJ3wnc3F1YXNoJ3wncmViYXNlJztcblxuLyoqXG4gKiBUYXJnZXQgbGFiZWxzIHJlcHJlc2VudCBHaXRodWIgcHVsbCByZXF1ZXN0cyBsYWJlbHMuIFRoZXNlIGxhYmVscyBpbnN0cnVjdCB0aGUgbWVyZ2VcbiAqIHNjcmlwdCBpbnRvIHdoaWNoIGJyYW5jaGVzIGEgZ2l2ZW4gcHVsbCByZXF1ZXN0IHNob3VsZCBiZSBtZXJnZWQgdG8uXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVGFyZ2V0TGFiZWwge1xuICAvKiogUGF0dGVybiB0aGF0IG1hdGNoZXMgdGhlIGdpdmVuIHRhcmdldCBsYWJlbC4gKi9cbiAgcGF0dGVybjogUmVnRXhwfHN0cmluZztcbiAgLyoqXG4gICAqIExpc3Qgb2YgYnJhbmNoZXMgYSBwdWxsIHJlcXVlc3Qgd2l0aCB0aGlzIHRhcmdldCBsYWJlbCBzaG91bGQgYmUgbWVyZ2VkIGludG8uXG4gICAqIENhbiBhbHNvIGJlIHdyYXBwZWQgaW4gYSBmdW5jdGlvbiB0aGF0IGFjY2VwdHMgdGhlIHRhcmdldCBicmFuY2ggc3BlY2lmaWVkIGluIHRoZVxuICAgKiBHaXRodWIgV2ViIFVJLiBUaGlzIGlzIHVzZWZ1bCBmb3Igc3VwcG9ydGluZyBsYWJlbHMgbGlrZSBgdGFyZ2V0OiBkZXZlbG9wbWVudC1icmFuY2hgLlxuICAgKlxuICAgKiBAdGhyb3dzIHtJbnZhbGlkVGFyZ2V0TGFiZWxFcnJvcn0gSW52YWxpZCBsYWJlbCBoYXMgYmVlbiBhcHBsaWVkIHRvIHB1bGwgcmVxdWVzdC5cbiAgICogQHRocm93cyB7SW52YWxpZFRhcmdldEJyYW5jaEVycm9yfSBJbnZhbGlkIEdpdGh1YiB0YXJnZXQgYnJhbmNoIGhhcyBiZWVuIHNlbGVjdGVkLlxuICAgKi9cbiAgYnJhbmNoZXM6IFRhcmdldExhYmVsQnJhbmNoUmVzdWx0fCgoZ2l0aHViVGFyZ2V0QnJhbmNoOiBzdHJpbmcpID0+IFRhcmdldExhYmVsQnJhbmNoUmVzdWx0KTtcbn1cblxuLyoqXG4gKiBDb25maWd1cmF0aW9uIGZvciB0aGUgbWVyZ2Ugc2NyaXB0IHdpdGggYWxsIHJlbW90ZSBvcHRpb25zIHNwZWNpZmllZC4gVGhlXG4gKiBkZWZhdWx0IGBNZXJnZUNvbmZpZ2AgaGFzIGRvZXMgbm90IHJlcXVpcmUgYW55IG9mIHRoZXNlIG9wdGlvbnMgYXMgZGVmYXVsdHNcbiAqIGFyZSBwcm92aWRlZCBieSB0aGUgY29tbW9uIGRldi1pbmZyYSBnaXRodWIgY29uZmlndXJhdGlvbi5cbiAqL1xuZXhwb3J0IHR5cGUgTWVyZ2VDb25maWdXaXRoUmVtb3RlID0gTWVyZ2VDb25maWcme3JlbW90ZTogR2l0Q2xpZW50Q29uZmlnfTtcblxuLyoqIENvbmZpZ3VyYXRpb24gZm9yIHRoZSBtZXJnZSBzY3JpcHQuICovXG5leHBvcnQgaW50ZXJmYWNlIE1lcmdlQ29uZmlnIHtcbiAgLyoqXG4gICAqIENvbmZpZ3VyYXRpb24gZm9yIHRoZSB1cHN0cmVhbSByZW1vdGUuIEFsbCBvZiB0aGVzZSBvcHRpb25zIGFyZSBvcHRpb25hbCBhc1xuICAgKiBkZWZhdWx0cyBhcmUgcHJvdmlkZWQgYnkgdGhlIGNvbW1vbiBkZXYtaW5mcmEgZ2l0aHViIGNvbmZpZ3VyYXRpb24uXG4gICAqL1xuICByZW1vdGU/OiBHaXRDbGllbnRDb25maWc7XG4gIC8qKiBMaXN0IG9mIHRhcmdldCBsYWJlbHMuICovXG4gIGxhYmVsczogVGFyZ2V0TGFiZWxbXTtcbiAgLyoqIFJlcXVpcmVkIGJhc2UgY29tbWl0cyBmb3IgZ2l2ZW4gYnJhbmNoZXMuICovXG4gIHJlcXVpcmVkQmFzZUNvbW1pdHM/OiB7W2JyYW5jaE5hbWU6IHN0cmluZ106IHN0cmluZ307XG4gIC8qKiBQYXR0ZXJuIHRoYXQgbWF0Y2hlcyBsYWJlbHMgd2hpY2ggaW1wbHkgYSBzaWduZWQgQ0xBLiAqL1xuICBjbGFTaWduZWRMYWJlbDogc3RyaW5nfFJlZ0V4cDtcbiAgLyoqIFBhdHRlcm4gdGhhdCBtYXRjaGVzIGxhYmVscyB3aGljaCBpbXBseSBhIG1lcmdlIHJlYWR5IHB1bGwgcmVxdWVzdC4gKi9cbiAgbWVyZ2VSZWFkeUxhYmVsOiBzdHJpbmd8UmVnRXhwO1xuICAvKiogTGFiZWwgdGhhdCBpcyBhcHBsaWVkIHdoZW4gc3BlY2lhbCBhdHRlbnRpb24gZnJvbSB0aGUgY2FyZXRha2VyIGlzIHJlcXVpcmVkLiAqL1xuICBjYXJldGFrZXJOb3RlTGFiZWw/OiBzdHJpbmd8UmVnRXhwO1xuICAvKiogTGFiZWwgd2hpY2ggY2FuIGJlIGFwcGxpZWQgdG8gZml4dXAgY29tbWl0IG1lc3NhZ2VzIGluIHRoZSBtZXJnZSBzY3JpcHQuICovXG4gIGNvbW1pdE1lc3NhZ2VGaXh1cExhYmVsOiBzdHJpbmd8UmVnRXhwO1xuICAvKiogTGFiZWwgdGhhdCBpcyBhcHBsaWVkIHdoZW4gYSBicmVha2luZyBjaGFuZ2UgaXMgbWFkZSBpbiB0aGUgcHVsbCByZXF1ZXN0LiAqL1xuICBicmVha2luZ0NoYW5nZUxhYmVsPzogc3RyaW5nO1xuICAvKipcbiAgICogV2hldGhlciBwdWxsIHJlcXVlc3RzIHNob3VsZCBiZSBtZXJnZWQgdXNpbmcgdGhlIEdpdGh1YiBBUEkuIFRoaXMgY2FuIGJlIGVuYWJsZWRcbiAgICogaWYgcHJvamVjdHMgd2FudCB0byBoYXZlIHRoZWlyIHB1bGwgcmVxdWVzdHMgc2hvdyB1cCBhcyBgTWVyZ2VkYCBpbiB0aGUgR2l0aHViIFVJLlxuICAgKiBUaGUgZG93bnNpZGUgaXMgdGhhdCBmaXh1cCBvciBzcXVhc2ggY29tbWl0cyBubyBsb25nZXIgd29yayBhcyB0aGUgR2l0aHViIEFQSSBkb2VzXG4gICAqIG5vdCBzdXBwb3J0IHRoaXMuXG4gICAqL1xuICBnaXRodWJBcGlNZXJnZTogZmFsc2V8R2l0aHViQXBpTWVyZ2VTdHJhdGVneUNvbmZpZztcbiAgLyoqXG4gICAqIExpc3Qgb2YgY29tbWl0IHNjb3BlcyB3aGljaCBhcmUgZXhlbXB0ZWQgZnJvbSB0YXJnZXQgbGFiZWwgY29udGVudCByZXF1aXJlbWVudHMuIGkuZS4gbm8gYGZlYXRgXG4gICAqIHNjb3BlcyBpbiBwYXRjaCBicmFuY2hlcywgbm8gYnJlYWtpbmcgY2hhbmdlcyBpbiBtaW5vciBvciBwYXRjaCBjaGFuZ2VzLlxuICAgKi9cbiAgdGFyZ2V0TGFiZWxFeGVtcHRTY29wZXM/OiBzdHJpbmdbXTtcbn1cblxuLyoqXG4gKiBDb25maWd1cmF0aW9uIG9mIHRoZSBtZXJnZSBzY3JpcHQgaW4gdGhlIGRldi1pbmZyYSBjb25maWd1cmF0aW9uLiBOb3RlIHRoYXQgdGhlXG4gKiBtZXJnZSBjb25maWd1cmF0aW9uIGlzIHJldHJpZXZlZCBsYXppbHkgYXMgdXN1YWxseSB0aGVzZSBjb25maWd1cmF0aW9ucyByZWx5XG4gKiBvbiBicmFuY2ggbmFtZSBjb21wdXRhdGlvbnMuIFdlIGRvbid0IHdhbnQgdG8gcnVuIHRoZXNlIGltbWVkaWF0ZWx5IHdoZW5ldmVyXG4gKiB0aGUgZGV2LWluZnJhIGNvbmZpZ3VyYXRpb24gaXMgbG9hZGVkIGFzIHRoYXQgY291bGQgc2xvdy1kb3duIG90aGVyIGNvbW1hbmRzLlxuICovXG5leHBvcnQgdHlwZSBEZXZJbmZyYU1lcmdlQ29uZmlnID1cbiAgICBOZ0RldkNvbmZpZzx7J21lcmdlJzogKGFwaTogR2l0aHViQ2xpZW50KSA9PiBNZXJnZUNvbmZpZyB8IFByb21pc2U8TWVyZ2VDb25maWc+fT47XG5cbi8qKiBMb2FkcyBhbmQgdmFsaWRhdGVzIHRoZSBtZXJnZSBjb25maWd1cmF0aW9uLiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvYWRBbmRWYWxpZGF0ZUNvbmZpZyhcbiAgICBjb25maWc6IFBhcnRpYWw8RGV2SW5mcmFNZXJnZUNvbmZpZz4sXG4gICAgYXBpOiBHaXRodWJDbGllbnQpOiBQcm9taXNlPHtjb25maWc/OiBNZXJnZUNvbmZpZywgZXJyb3JzPzogc3RyaW5nW119PiB7XG4gIGlmIChjb25maWcubWVyZ2UgPT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiB7ZXJyb3JzOiBbJ05vIG1lcmdlIGNvbmZpZ3VyYXRpb24gZm91bmQuIFNldCB0aGUgYG1lcmdlYCBjb25maWd1cmF0aW9uLiddfTtcbiAgfVxuXG4gIGlmICh0eXBlb2YgY29uZmlnLm1lcmdlICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgcmV0dXJuIHtlcnJvcnM6IFsnRXhwZWN0ZWQgbWVyZ2UgY29uZmlndXJhdGlvbiB0byBiZSBkZWZpbmVkIGxhemlseSB0aHJvdWdoIGEgZnVuY3Rpb24uJ119O1xuICB9XG5cbiAgY29uc3QgbWVyZ2VDb25maWcgPSBhd2FpdCBjb25maWcubWVyZ2UoYXBpKTtcbiAgY29uc3QgZXJyb3JzID0gdmFsaWRhdGVNZXJnZUNvbmZpZyhtZXJnZUNvbmZpZyk7XG5cbiAgaWYgKGVycm9ycy5sZW5ndGgpIHtcbiAgICByZXR1cm4ge2Vycm9yc307XG4gIH1cblxuICByZXR1cm4ge2NvbmZpZzogbWVyZ2VDb25maWd9O1xufVxuXG4vKiogVmFsaWRhdGVzIHRoZSBzcGVjaWZpZWQgY29uZmlndXJhdGlvbi4gUmV0dXJucyBhIGxpc3Qgb2YgZmFpbHVyZSBtZXNzYWdlcy4gKi9cbmZ1bmN0aW9uIHZhbGlkYXRlTWVyZ2VDb25maWcoY29uZmlnOiBQYXJ0aWFsPE1lcmdlQ29uZmlnPik6IHN0cmluZ1tdIHtcbiAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuICBpZiAoIWNvbmZpZy5sYWJlbHMpIHtcbiAgICBlcnJvcnMucHVzaCgnTm8gbGFiZWwgY29uZmlndXJhdGlvbi4nKTtcbiAgfSBlbHNlIGlmICghQXJyYXkuaXNBcnJheShjb25maWcubGFiZWxzKSkge1xuICAgIGVycm9ycy5wdXNoKCdMYWJlbCBjb25maWd1cmF0aW9uIG5lZWRzIHRvIGJlIGFuIGFycmF5LicpO1xuICB9XG4gIGlmICghY29uZmlnLmNsYVNpZ25lZExhYmVsKSB7XG4gICAgZXJyb3JzLnB1c2goJ05vIENMQSBzaWduZWQgbGFiZWwgY29uZmlndXJlZC4nKTtcbiAgfVxuICBpZiAoIWNvbmZpZy5tZXJnZVJlYWR5TGFiZWwpIHtcbiAgICBlcnJvcnMucHVzaCgnTm8gbWVyZ2UgcmVhZHkgbGFiZWwgY29uZmlndXJlZC4nKTtcbiAgfVxuICBpZiAoY29uZmlnLmdpdGh1YkFwaU1lcmdlID09PSB1bmRlZmluZWQpIHtcbiAgICBlcnJvcnMucHVzaCgnTm8gZXhwbGljaXQgY2hvaWNlIG9mIG1lcmdlIHN0cmF0ZWd5LiBQbGVhc2Ugc2V0IGBnaXRodWJBcGlNZXJnZWAuJyk7XG4gIH1cbiAgcmV0dXJuIGVycm9ycztcbn1cbiJdfQ==