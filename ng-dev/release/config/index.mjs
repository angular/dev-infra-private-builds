"use strict";
/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.assertValidReleaseConfig = void 0;
const config_1 = require("../../utils/config");
/** Asserts that the given configuration is a valid `DevInfraReleaseConfig`. */
function assertValidReleaseConfig(config) {
    // List of errors encountered validating the config.
    const errors = [];
    if (config.release === undefined) {
        throw new config_1.ConfigValidationError('No configuration provided for `release`');
    }
    if (config.release.representativeNpmPackage === undefined) {
        errors.push(`No "representativeNpmPackage" configured for releasing.`);
    }
    if (config.release.npmPackages === undefined) {
        errors.push(`No "npmPackages" configured for releasing.`);
    }
    if (config.release.buildPackages === undefined) {
        errors.push(`No "buildPackages" function configured for releasing.`);
    }
    if (config.release.representativeNpmPackage && config.release.npmPackages) {
        const representativePkgEntry = config.release.npmPackages.find((pkg) => pkg.name === config.release?.representativeNpmPackage);
        if (representativePkgEntry === undefined) {
            errors.push(`Configured "representativeNpmPackage" (${representativePkgEntry}) does not match ` +
                `a package in "npmPackages".`);
        }
        else if (representativePkgEntry.experimental) {
            errors.push(`Configured "representativeNpmPackage" (${representativePkgEntry}) corresponds to an ` +
                `experimental package. The representative NPM package is expected to be a ` +
                `long-standing and non-experimental package of the project.`);
        }
    }
    if (errors.length) {
        throw new config_1.ConfigValidationError('Invalid `release` configuration', errors);
    }
}
exports.assertValidReleaseConfig = assertValidReleaseConfig;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9uZy1kZXYvcmVsZWFzZS9jb25maWcvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7R0FNRzs7O0FBR0gsK0NBQXlEO0FBaUZ6RCwrRUFBK0U7QUFDL0UsU0FBZ0Isd0JBQXdCLENBQ3RDLE1BQTBDO0lBRTFDLG9EQUFvRDtJQUNwRCxNQUFNLE1BQU0sR0FBYSxFQUFFLENBQUM7SUFFNUIsSUFBSSxNQUFNLENBQUMsT0FBTyxLQUFLLFNBQVMsRUFBRTtRQUNoQyxNQUFNLElBQUksOEJBQXFCLENBQUMseUNBQXlDLENBQUMsQ0FBQztLQUM1RTtJQUNELElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyx3QkFBd0IsS0FBSyxTQUFTLEVBQUU7UUFDekQsTUFBTSxDQUFDLElBQUksQ0FBQyx5REFBeUQsQ0FBQyxDQUFDO0tBQ3hFO0lBQ0QsSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLFdBQVcsS0FBSyxTQUFTLEVBQUU7UUFDNUMsTUFBTSxDQUFDLElBQUksQ0FBQyw0Q0FBNEMsQ0FBQyxDQUFDO0tBQzNEO0lBQ0QsSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLGFBQWEsS0FBSyxTQUFTLEVBQUU7UUFDOUMsTUFBTSxDQUFDLElBQUksQ0FBQyx1REFBdUQsQ0FBQyxDQUFDO0tBQ3RFO0lBRUQsSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLHdCQUF3QixJQUFJLE1BQU0sQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFO1FBQ3pFLE1BQU0sc0JBQXNCLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUM1RCxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksS0FBSyxNQUFNLENBQUMsT0FBTyxFQUFFLHdCQUF3QixDQUMvRCxDQUFDO1FBRUYsSUFBSSxzQkFBc0IsS0FBSyxTQUFTLEVBQUU7WUFDeEMsTUFBTSxDQUFDLElBQUksQ0FDVCwwQ0FBMEMsc0JBQXNCLG1CQUFtQjtnQkFDakYsNkJBQTZCLENBQ2hDLENBQUM7U0FDSDthQUFNLElBQUksc0JBQXNCLENBQUMsWUFBWSxFQUFFO1lBQzlDLE1BQU0sQ0FBQyxJQUFJLENBQ1QsMENBQTBDLHNCQUFzQixzQkFBc0I7Z0JBQ3BGLDJFQUEyRTtnQkFDM0UsNERBQTRELENBQy9ELENBQUM7U0FDSDtLQUNGO0lBRUQsSUFBSSxNQUFNLENBQUMsTUFBTSxFQUFFO1FBQ2pCLE1BQU0sSUFBSSw4QkFBcUIsQ0FBQyxpQ0FBaUMsRUFBRSxNQUFNLENBQUMsQ0FBQztLQUM1RTtBQUNILENBQUM7QUF6Q0QsNERBeUNDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IEdvb2dsZSBMTEMgQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhbiBNSVQtc3R5bGUgbGljZW5zZSB0aGF0IGNhbiBiZVxuICogZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBhdCBodHRwczovL2FuZ3VsYXIuaW8vbGljZW5zZVxuICovXG5cbmltcG9ydCB7Q29tbWl0RnJvbUdpdExvZ30gZnJvbSAnLi4vLi4vY29tbWl0LW1lc3NhZ2UvcGFyc2UnO1xuaW1wb3J0IHtDb25maWdWYWxpZGF0aW9uRXJyb3J9IGZyb20gJy4uLy4uL3V0aWxzL2NvbmZpZyc7XG5cbi8qKiBJbnRlcmZhY2UgZGVzY3JpYmluZyBhIGJ1aWx0IHBhY2thZ2UuICovXG5leHBvcnQgaW50ZXJmYWNlIEJ1aWx0UGFja2FnZSB7XG4gIC8qKiBOYW1lIG9mIHRoZSBwYWNrYWdlLiAqL1xuICBuYW1lOiBzdHJpbmc7XG4gIC8qKiBQYXRoIHRvIHRoZSBwYWNrYWdlIG91dHB1dCBkaXJlY3RvcnkuICovXG4gIG91dHB1dFBhdGg6IHN0cmluZztcbn1cblxuLyoqIEludGVyZmFjZSBkZXNjcmliaW5nIGEgTlBNIHBhY2thZ2UgdGhhdCB3aWxsIGJlIHJlbGVhc2VkLiAqL1xuZXhwb3J0IGludGVyZmFjZSBOcG1QYWNrYWdlIHtcbiAgLyoqIE5hbWUgb2YgdGhlIHBhY2thZ2UuICovXG4gIG5hbWU6IHN0cmluZztcbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIHBhY2thZ2UgaXMgZXhwZXJpbWVudGFsLlxuICAgKlxuICAgKiBQYWNrYWdlcyBtYXJrZWQgYXMgZXhwZXJpbWVudGFsIHdpbGwgdXNlIGV4cGVyaW1lbnRhbCBTZW1WZXIgdmVyc2lvbmluZ1xuICAgKiBhbmQgd2lsbCBub3QgaGF2ZSBhbnkgTFRTIGRpc3QgdGFncyBjb25maWd1cmVkLlxuICAgKi9cbiAgZXhwZXJpbWVudGFsPzogYm9vbGVhbjtcbn1cblxuLyoqIENvbmZpZ3VyYXRpb24gZm9yIHN0YWdpbmcgYW5kIHB1Ymxpc2hpbmcgYSByZWxlYXNlLiAqL1xuZXhwb3J0IGludGVyZmFjZSBSZWxlYXNlQ29uZmlnIHtcbiAgLyoqIFJlZ2lzdHJ5IFVSTCB1c2VkIGZvciBwdWJsaXNoaW5nIHJlbGVhc2UgcGFja2FnZXMuIERlZmF1bHRzIHRvIHRoZSBOUE0gcmVnaXN0cnkuICovXG4gIHB1Ymxpc2hSZWdpc3RyeT86IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSByZXByZXNlbnRhdGl2ZSBOUE0gcGFja2FnZSBmb3IgdGhpcyBwcm9qZWN0LiBUaGUgc3BlY2lmaWVkIHBhY2thZ2Ugd2lsbCBiZSB1c2VkXG4gICAqIGZvciBxdWVyeWluZyB0aGUgTlBNIHJlZ2lzdHJ5IHRvIGUuZy4gZGV0ZXJtaW5lIGFjdGl2ZSBMVFMgYnJhbmNoZXMuXG4gICAqXG4gICAqIEEgcmVwcmVzZW50YXRpdmUgcGFja2FnZSBpcyBleHBlY3RlZCB0byBiZSBhIGxvbmctc3RhbmRpbmcsIG5vbi1leHBlcmltZW50YWwgcGFja2FnZVxuICAgKiB0aGF0IGlzIG1hbmFnZWQgYW5kIHJlbGVhc2VkIGFzIHBhcnQgb2YgdGhlIGBuZy1kZXYgcmVsZWFzZWAgY29tbWFuZC5cbiAgICovXG4gIHJlcHJlc2VudGF0aXZlTnBtUGFja2FnZTogc3RyaW5nO1xuICAvKiogTGlzdCBvZiBOUE0gcGFja2FnZXMgdGhhdCBhcmUgcHVibGlzaGVkIGFzIHBhcnQgb2YgdGhpcyBwcm9qZWN0LiAqL1xuICBucG1QYWNrYWdlczogTnBtUGFja2FnZVtdO1xuICAvKiogQnVpbGRzIHJlbGVhc2UgcGFja2FnZXMgYW5kIHJldHVybnMgYSBsaXN0IG9mIHBhdGhzIHBvaW50aW5nIHRvIHRoZSBvdXRwdXQuICovXG4gIGJ1aWxkUGFja2FnZXM6ICgpID0+IFByb21pc2U8QnVpbHRQYWNrYWdlW10gfCBudWxsPjtcbiAgLyoqIFRoZSBsaXN0IG9mIGdpdGh1YiBsYWJlbHMgdG8gYWRkIHRvIHRoZSByZWxlYXNlIFBScy4gKi9cbiAgcmVsZWFzZVByTGFiZWxzPzogc3RyaW5nW107XG4gIC8qKiBDb25maWd1cmF0aW9uIGZvciBjcmVhdGluZyByZWxlYXNlIG5vdGVzIGR1cmluZyBwdWJsaXNoaW5nLiAqL1xuICByZWxlYXNlTm90ZXM/OiBSZWxlYXNlTm90ZXNDb25maWc7XG59XG5cbi8qKiBDb25maWd1cmF0aW9uIGZvciBjcmVhdGluZyByZWxlYXNlIG5vdGVzIGR1cmluZyBwdWJsaXNoaW5nLiAqL1xuZXhwb3J0IGludGVyZmFjZSBSZWxlYXNlTm90ZXNDb25maWcge1xuICAvKiogV2hldGhlciB0byBwcm9tcHQgZm9yIGFuZCBpbmNsdWRlIGEgcmVsZWFzZSB0aXRsZSBpbiB0aGUgZ2VuZXJhdGVkIHJlbGVhc2Ugbm90ZXMuICovXG4gIHVzZVJlbGVhc2VUaXRsZT86IGJvb2xlYW47XG4gIC8qKiBMaXN0IG9mIGNvbW1pdCBzY29wZXMgdG8gZXhjbHVkZSBmcm9tIGdlbmVyYXRlZCByZWxlYXNlIG5vdGVzLiAqL1xuICBoaWRkZW5TY29wZXM/OiBzdHJpbmdbXTtcbiAgLyoqIE9wdGlvbmFsIGZ1bmN0aW9uIHRoYXQgY2FuIGJlIHVzZWQgdG8gY2F0ZWdvcml6ZSBjb21taXRzIGZvciB0aGUgcmVsZWFzZSBub3Rlcy4gKi9cbiAgY2F0ZWdvcml6ZUNvbW1pdD86IChjb21taXQ6IENvbW1pdEZyb21HaXRMb2cpID0+IHtcbiAgICAvKipcbiAgICAgKiBOYW1lIG9mIHRoZSBncm91cCB0aGUgY29tbWl0IHNob3VsZCBiZSBkaXNwbGF5ZWQgd2l0aGluLiBJZiBub3Qgc3BlY2lmaWVkLFxuICAgICAqIGNvbW1pdHMgd2lsbCBiZSBncm91cGVkIGJhc2VkIG9uIHRoZWlyIHNjb3BlLlxuICAgICAqL1xuICAgIGdyb3VwTmFtZT86IHN0cmluZztcbiAgICAvKipcbiAgICAgKiBEZXNjcmlwdGlvbiBvZiB0aGUgY29tbWl0LiBUaGlzIG9wdGlvbiBhbGxvd3MgY29uc3VtZXJzIHRvIGluY29ycG9yYXRlIGFkZGl0aW9uYWxcbiAgICAgKiBpbmZvcm1hdGlvbiBmb3IgY29tbWl0cyB0aGF0IHdvdWxkIG90aGVyd2lzZSBub3QgYmUgY2FwdHVyZWQuXG4gICAgICpcbiAgICAgKiBJZiBub3Qgc3BlY2lmaWVkLCB0aGUgY29tbWl0IHN1YmplY3QgaXMgdXNlZCBhcyBkZXNjcmlwdGlvbi4gaS5lLiB0aGUgZGVzY3JpcHRpb24gZG9lc1xuICAgICAqIG5vdCBpbmNsdWRlIHRoZSB0eXBlIGFuZCBzY29wZS4gZS5nLiBgZml4KGEpOiA8ZGVzYz5gIHdpbGwgdHVybiBpbnRvIGA8ZGVzYz5gLlxuICAgICAqL1xuICAgIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICB9O1xuICAvKipcbiAgICogTGlzdCB0aGF0IGNhbiBiZSBzZXQgdG8gY29udHJvbCB0aGUgb3JkZXIgb2YgaG93IGdyb3VwcyBhcHBlYXIgaW4gdGhlIHJlbGVhc2VcbiAgICogbm90ZXMuIEVsZW1lbnRzIGluIHRoZSBsaXN0IG5lZWQgdG8gbWF0Y2ggd2l0aCB0aGUgZ3JvdXBzIGFzIGRldGVybWluZWQgYWNjb3JkaW5nXG4gICAqIHRvIHRoZSBgY29tbWl0VG9Hcm91cGAgb3B0aW9uLlxuICAgKlxuICAgKiBFYWNoIGdyb3VwIGZvciB0aGUgcmVsZWFzZSBub3Rlcywgd2lsbCBhcHBlYXIgaW4gdGhlIG9yZGVyIHByb3ZpZGVkIGluIGBncm91cE9yZGVyYFxuICAgKiBhbmQgYW55IG90aGVyIGdyb3VwcyB3aWxsIGFwcGVhciBhZnRlciB0aGVzZSBncm91cHMsIHNvcnRlZCBhbHBoYW51bWVyaWNhbGx5LlxuICAgKi9cbiAgZ3JvdXBPcmRlcj86IHN0cmluZ1tdO1xufVxuXG4vKiogQ29uZmlndXJhdGlvbiBmb3IgcmVsZWFzZXMgaW4gdGhlIGRldi1pbmZyYSBjb25maWd1cmF0aW9uLiAqL1xuZXhwb3J0IHR5cGUgRGV2SW5mcmFSZWxlYXNlQ29uZmlnID0ge3JlbGVhc2U6IFJlbGVhc2VDb25maWd9O1xuXG4vKiogQXNzZXJ0cyB0aGF0IHRoZSBnaXZlbiBjb25maWd1cmF0aW9uIGlzIGEgdmFsaWQgYERldkluZnJhUmVsZWFzZUNvbmZpZ2AuICovXG5leHBvcnQgZnVuY3Rpb24gYXNzZXJ0VmFsaWRSZWxlYXNlQ29uZmlnPFQ+KFxuICBjb25maWc6IFQgJiBQYXJ0aWFsPERldkluZnJhUmVsZWFzZUNvbmZpZz4sXG4pOiBhc3NlcnRzIGNvbmZpZyBpcyBUICYgRGV2SW5mcmFSZWxlYXNlQ29uZmlnIHtcbiAgLy8gTGlzdCBvZiBlcnJvcnMgZW5jb3VudGVyZWQgdmFsaWRhdGluZyB0aGUgY29uZmlnLlxuICBjb25zdCBlcnJvcnM6IHN0cmluZ1tdID0gW107XG5cbiAgaWYgKGNvbmZpZy5yZWxlYXNlID09PSB1bmRlZmluZWQpIHtcbiAgICB0aHJvdyBuZXcgQ29uZmlnVmFsaWRhdGlvbkVycm9yKCdObyBjb25maWd1cmF0aW9uIHByb3ZpZGVkIGZvciBgcmVsZWFzZWAnKTtcbiAgfVxuICBpZiAoY29uZmlnLnJlbGVhc2UucmVwcmVzZW50YXRpdmVOcG1QYWNrYWdlID09PSB1bmRlZmluZWQpIHtcbiAgICBlcnJvcnMucHVzaChgTm8gXCJyZXByZXNlbnRhdGl2ZU5wbVBhY2thZ2VcIiBjb25maWd1cmVkIGZvciByZWxlYXNpbmcuYCk7XG4gIH1cbiAgaWYgKGNvbmZpZy5yZWxlYXNlLm5wbVBhY2thZ2VzID09PSB1bmRlZmluZWQpIHtcbiAgICBlcnJvcnMucHVzaChgTm8gXCJucG1QYWNrYWdlc1wiIGNvbmZpZ3VyZWQgZm9yIHJlbGVhc2luZy5gKTtcbiAgfVxuICBpZiAoY29uZmlnLnJlbGVhc2UuYnVpbGRQYWNrYWdlcyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgZXJyb3JzLnB1c2goYE5vIFwiYnVpbGRQYWNrYWdlc1wiIGZ1bmN0aW9uIGNvbmZpZ3VyZWQgZm9yIHJlbGVhc2luZy5gKTtcbiAgfVxuXG4gIGlmIChjb25maWcucmVsZWFzZS5yZXByZXNlbnRhdGl2ZU5wbVBhY2thZ2UgJiYgY29uZmlnLnJlbGVhc2UubnBtUGFja2FnZXMpIHtcbiAgICBjb25zdCByZXByZXNlbnRhdGl2ZVBrZ0VudHJ5ID0gY29uZmlnLnJlbGVhc2UubnBtUGFja2FnZXMuZmluZChcbiAgICAgIChwa2cpID0+IHBrZy5uYW1lID09PSBjb25maWcucmVsZWFzZT8ucmVwcmVzZW50YXRpdmVOcG1QYWNrYWdlLFxuICAgICk7XG5cbiAgICBpZiAocmVwcmVzZW50YXRpdmVQa2dFbnRyeSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBlcnJvcnMucHVzaChcbiAgICAgICAgYENvbmZpZ3VyZWQgXCJyZXByZXNlbnRhdGl2ZU5wbVBhY2thZ2VcIiAoJHtyZXByZXNlbnRhdGl2ZVBrZ0VudHJ5fSkgZG9lcyBub3QgbWF0Y2ggYCArXG4gICAgICAgICAgYGEgcGFja2FnZSBpbiBcIm5wbVBhY2thZ2VzXCIuYCxcbiAgICAgICk7XG4gICAgfSBlbHNlIGlmIChyZXByZXNlbnRhdGl2ZVBrZ0VudHJ5LmV4cGVyaW1lbnRhbCkge1xuICAgICAgZXJyb3JzLnB1c2goXG4gICAgICAgIGBDb25maWd1cmVkIFwicmVwcmVzZW50YXRpdmVOcG1QYWNrYWdlXCIgKCR7cmVwcmVzZW50YXRpdmVQa2dFbnRyeX0pIGNvcnJlc3BvbmRzIHRvIGFuIGAgK1xuICAgICAgICAgIGBleHBlcmltZW50YWwgcGFja2FnZS4gVGhlIHJlcHJlc2VudGF0aXZlIE5QTSBwYWNrYWdlIGlzIGV4cGVjdGVkIHRvIGJlIGEgYCArXG4gICAgICAgICAgYGxvbmctc3RhbmRpbmcgYW5kIG5vbi1leHBlcmltZW50YWwgcGFja2FnZSBvZiB0aGUgcHJvamVjdC5gLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBpZiAoZXJyb3JzLmxlbmd0aCkge1xuICAgIHRocm93IG5ldyBDb25maWdWYWxpZGF0aW9uRXJyb3IoJ0ludmFsaWQgYHJlbGVhc2VgIGNvbmZpZ3VyYXRpb24nLCBlcnJvcnMpO1xuICB9XG59XG4iXX0=