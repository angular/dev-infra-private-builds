"use strict";
/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
Object.defineProperty(exports, "__esModule", { value: true });
/*
 * This file will be spawned as a separate process when the `ng-dev release build` command is
 * invoked. A separate process allows us to hide any superfluous stdout output from arbitrary
 * build commands that we cannot control. This is necessary as the `ng-dev release build` command
 * supports stdout JSON output that should be parsable and not polluted from other stdout messages.
 */
const config_1 = require("../../utils/config");
const index_1 = require("../config/index");
// Start the release package building.
main(process.argv[2] === 'true');
/** Main function for building the release packages. */
async function main(stampForRelease) {
    if (process.send === undefined) {
        throw Error('This script needs to be invoked as a NodeJS worker.');
    }
    const config = config_1.getConfig();
    index_1.assertValidReleaseConfig(config);
    const builtPackages = await config.release.buildPackages(stampForRelease);
    // Transfer the built packages back to the parent process.
    process.send(builtPackages);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGQtd29ya2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vbmctZGV2L3JlbGVhc2UvYnVpbGQvYnVpbGQtd29ya2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7O0dBTUc7O0FBRUg7Ozs7O0dBS0c7QUFFSCwrQ0FBNkM7QUFDN0MsMkNBQXlEO0FBRXpELHNDQUFzQztBQUN0QyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxNQUFNLENBQUMsQ0FBQztBQUVqQyx1REFBdUQ7QUFDdkQsS0FBSyxVQUFVLElBQUksQ0FBQyxlQUF3QjtJQUMxQyxJQUFJLE9BQU8sQ0FBQyxJQUFJLEtBQUssU0FBUyxFQUFFO1FBQzlCLE1BQU0sS0FBSyxDQUFDLHFEQUFxRCxDQUFDLENBQUM7S0FDcEU7SUFFRCxNQUFNLE1BQU0sR0FBRyxrQkFBUyxFQUFFLENBQUM7SUFDM0IsZ0NBQXdCLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDakMsTUFBTSxhQUFhLEdBQUcsTUFBTSxNQUFNLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxlQUFlLENBQUMsQ0FBQztJQUUxRSwwREFBMEQ7SUFDMUQsT0FBTyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUM5QixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IEdvb2dsZSBMTEMgQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhbiBNSVQtc3R5bGUgbGljZW5zZSB0aGF0IGNhbiBiZVxuICogZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBhdCBodHRwczovL2FuZ3VsYXIuaW8vbGljZW5zZVxuICovXG5cbi8qXG4gKiBUaGlzIGZpbGUgd2lsbCBiZSBzcGF3bmVkIGFzIGEgc2VwYXJhdGUgcHJvY2VzcyB3aGVuIHRoZSBgbmctZGV2IHJlbGVhc2UgYnVpbGRgIGNvbW1hbmQgaXNcbiAqIGludm9rZWQuIEEgc2VwYXJhdGUgcHJvY2VzcyBhbGxvd3MgdXMgdG8gaGlkZSBhbnkgc3VwZXJmbHVvdXMgc3Rkb3V0IG91dHB1dCBmcm9tIGFyYml0cmFyeVxuICogYnVpbGQgY29tbWFuZHMgdGhhdCB3ZSBjYW5ub3QgY29udHJvbC4gVGhpcyBpcyBuZWNlc3NhcnkgYXMgdGhlIGBuZy1kZXYgcmVsZWFzZSBidWlsZGAgY29tbWFuZFxuICogc3VwcG9ydHMgc3Rkb3V0IEpTT04gb3V0cHV0IHRoYXQgc2hvdWxkIGJlIHBhcnNhYmxlIGFuZCBub3QgcG9sbHV0ZWQgZnJvbSBvdGhlciBzdGRvdXQgbWVzc2FnZXMuXG4gKi9cblxuaW1wb3J0IHtnZXRDb25maWd9IGZyb20gJy4uLy4uL3V0aWxzL2NvbmZpZyc7XG5pbXBvcnQge2Fzc2VydFZhbGlkUmVsZWFzZUNvbmZpZ30gZnJvbSAnLi4vY29uZmlnL2luZGV4JztcblxuLy8gU3RhcnQgdGhlIHJlbGVhc2UgcGFja2FnZSBidWlsZGluZy5cbm1haW4ocHJvY2Vzcy5hcmd2WzJdID09PSAndHJ1ZScpO1xuXG4vKiogTWFpbiBmdW5jdGlvbiBmb3IgYnVpbGRpbmcgdGhlIHJlbGVhc2UgcGFja2FnZXMuICovXG5hc3luYyBmdW5jdGlvbiBtYWluKHN0YW1wRm9yUmVsZWFzZTogYm9vbGVhbikge1xuICBpZiAocHJvY2Vzcy5zZW5kID09PSB1bmRlZmluZWQpIHtcbiAgICB0aHJvdyBFcnJvcignVGhpcyBzY3JpcHQgbmVlZHMgdG8gYmUgaW52b2tlZCBhcyBhIE5vZGVKUyB3b3JrZXIuJyk7XG4gIH1cblxuICBjb25zdCBjb25maWcgPSBnZXRDb25maWcoKTtcbiAgYXNzZXJ0VmFsaWRSZWxlYXNlQ29uZmlnKGNvbmZpZyk7XG4gIGNvbnN0IGJ1aWx0UGFja2FnZXMgPSBhd2FpdCBjb25maWcucmVsZWFzZS5idWlsZFBhY2thZ2VzKHN0YW1wRm9yUmVsZWFzZSk7XG5cbiAgLy8gVHJhbnNmZXIgdGhlIGJ1aWx0IHBhY2thZ2VzIGJhY2sgdG8gdGhlIHBhcmVudCBwcm9jZXNzLlxuICBwcm9jZXNzLnNlbmQoYnVpbHRQYWNrYWdlcyk7XG59XG4iXX0=