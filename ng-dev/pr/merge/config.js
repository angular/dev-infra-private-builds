"use strict";
/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.loadAndValidateConfig = void 0;
/** Loads and validates the merge configuration. */
async function loadAndValidateConfig(config, api) {
    if (config.merge === undefined) {
        return { errors: ['No merge configuration found. Set the `merge` configuration.'] };
    }
    if (typeof config.merge !== 'function') {
        return { errors: ['Expected merge configuration to be defined lazily through a function.'] };
    }
    const mergeConfig = await config.merge(api);
    const errors = validateMergeConfig(mergeConfig);
    if (errors.length) {
        return { errors };
    }
    return { config: mergeConfig };
}
exports.loadAndValidateConfig = loadAndValidateConfig;
/** Validates the specified configuration. Returns a list of failure messages. */
function validateMergeConfig(config) {
    const errors = [];
    if (!config.labels) {
        errors.push('No label configuration.');
    }
    else if (!Array.isArray(config.labels)) {
        errors.push('Label configuration needs to be an array.');
    }
    if (!config.claSignedLabel) {
        errors.push('No CLA signed label configured.');
    }
    if (!config.mergeReadyLabel) {
        errors.push('No merge ready label configured.');
    }
    if (config.githubApiMerge === undefined) {
        errors.push('No explicit choice of merge strategy. Please set `githubApiMerge`.');
    }
    return errors;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vbmctZGV2L3ByL21lcmdlL2NvbmZpZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7OztHQU1HOzs7QUFzRkgsbURBQW1EO0FBQzVDLEtBQUssVUFBVSxxQkFBcUIsQ0FDekMsTUFBb0MsRUFDcEMsR0FBaUI7SUFFakIsSUFBSSxNQUFNLENBQUMsS0FBSyxLQUFLLFNBQVMsRUFBRTtRQUM5QixPQUFPLEVBQUMsTUFBTSxFQUFFLENBQUMsOERBQThELENBQUMsRUFBQyxDQUFDO0tBQ25GO0lBRUQsSUFBSSxPQUFPLE1BQU0sQ0FBQyxLQUFLLEtBQUssVUFBVSxFQUFFO1FBQ3RDLE9BQU8sRUFBQyxNQUFNLEVBQUUsQ0FBQyx1RUFBdUUsQ0FBQyxFQUFDLENBQUM7S0FDNUY7SUFFRCxNQUFNLFdBQVcsR0FBRyxNQUFNLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDNUMsTUFBTSxNQUFNLEdBQUcsbUJBQW1CLENBQUMsV0FBVyxDQUFDLENBQUM7SUFFaEQsSUFBSSxNQUFNLENBQUMsTUFBTSxFQUFFO1FBQ2pCLE9BQU8sRUFBQyxNQUFNLEVBQUMsQ0FBQztLQUNqQjtJQUVELE9BQU8sRUFBQyxNQUFNLEVBQUUsV0FBVyxFQUFDLENBQUM7QUFDL0IsQ0FBQztBQXBCRCxzREFvQkM7QUFFRCxpRkFBaUY7QUFDakYsU0FBUyxtQkFBbUIsQ0FBQyxNQUE0QjtJQUN2RCxNQUFNLE1BQU0sR0FBYSxFQUFFLENBQUM7SUFDNUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUU7UUFDbEIsTUFBTSxDQUFDLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO0tBQ3hDO1NBQU0sSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFO1FBQ3hDLE1BQU0sQ0FBQyxJQUFJLENBQUMsMkNBQTJDLENBQUMsQ0FBQztLQUMxRDtJQUNELElBQUksQ0FBQyxNQUFNLENBQUMsY0FBYyxFQUFFO1FBQzFCLE1BQU0sQ0FBQyxJQUFJLENBQUMsaUNBQWlDLENBQUMsQ0FBQztLQUNoRDtJQUNELElBQUksQ0FBQyxNQUFNLENBQUMsZUFBZSxFQUFFO1FBQzNCLE1BQU0sQ0FBQyxJQUFJLENBQUMsa0NBQWtDLENBQUMsQ0FBQztLQUNqRDtJQUNELElBQUksTUFBTSxDQUFDLGNBQWMsS0FBSyxTQUFTLEVBQUU7UUFDdkMsTUFBTSxDQUFDLElBQUksQ0FBQyxvRUFBb0UsQ0FBQyxDQUFDO0tBQ25GO0lBQ0QsT0FBTyxNQUFNLENBQUM7QUFDaEIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBHb29nbGUgTExDIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYW4gTUlULXN0eWxlIGxpY2Vuc2UgdGhhdCBjYW4gYmVcbiAqIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUgYXQgaHR0cHM6Ly9hbmd1bGFyLmlvL2xpY2Vuc2VcbiAqL1xuXG5pbXBvcnQge0dpdENsaWVudENvbmZpZywgTmdEZXZDb25maWd9IGZyb20gJy4uLy4uL3V0aWxzL2NvbmZpZyc7XG5pbXBvcnQge0dpdGh1YkNsaWVudH0gZnJvbSAnLi4vLi4vdXRpbHMvZ2l0L2dpdGh1Yic7XG5cbmltcG9ydCB7R2l0aHViQXBpTWVyZ2VTdHJhdGVneUNvbmZpZ30gZnJvbSAnLi9zdHJhdGVnaWVzL2FwaS1tZXJnZSc7XG5cbi8qKiBEZXNjcmliZXMgcG9zc2libGUgdmFsdWVzIHRoYXQgY2FuIGJlIHJldHVybmVkIGZvciBgYnJhbmNoZXNgIG9mIGEgdGFyZ2V0IGxhYmVsLiAqL1xuZXhwb3J0IHR5cGUgVGFyZ2V0TGFiZWxCcmFuY2hSZXN1bHQgPSBzdHJpbmdbXSB8IFByb21pc2U8c3RyaW5nW10+O1xuXG4vKipcbiAqIFBvc3NpYmxlIG1lcmdlIG1ldGhvZHMgc3VwcG9ydGVkIGJ5IHRoZSBHaXRodWIgQVBJLlxuICogaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92My9wdWxscy8jbWVyZ2UtYS1wdWxsLXJlcXVlc3QtbWVyZ2UtYnV0dG9uLlxuICovXG5leHBvcnQgdHlwZSBHaXRodWJBcGlNZXJnZU1ldGhvZCA9ICdtZXJnZScgfCAnc3F1YXNoJyB8ICdyZWJhc2UnO1xuXG4vKipcbiAqIFRhcmdldCBsYWJlbHMgcmVwcmVzZW50IEdpdGh1YiBwdWxsIHJlcXVlc3RzIGxhYmVscy4gVGhlc2UgbGFiZWxzIGluc3RydWN0IHRoZSBtZXJnZVxuICogc2NyaXB0IGludG8gd2hpY2ggYnJhbmNoZXMgYSBnaXZlbiBwdWxsIHJlcXVlc3Qgc2hvdWxkIGJlIG1lcmdlZCB0by5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBUYXJnZXRMYWJlbCB7XG4gIC8qKiBQYXR0ZXJuIHRoYXQgbWF0Y2hlcyB0aGUgZ2l2ZW4gdGFyZ2V0IGxhYmVsLiAqL1xuICBwYXR0ZXJuOiBSZWdFeHAgfCBzdHJpbmc7XG4gIC8qKlxuICAgKiBMaXN0IG9mIGJyYW5jaGVzIGEgcHVsbCByZXF1ZXN0IHdpdGggdGhpcyB0YXJnZXQgbGFiZWwgc2hvdWxkIGJlIG1lcmdlZCBpbnRvLlxuICAgKiBDYW4gYWxzbyBiZSB3cmFwcGVkIGluIGEgZnVuY3Rpb24gdGhhdCBhY2NlcHRzIHRoZSB0YXJnZXQgYnJhbmNoIHNwZWNpZmllZCBpbiB0aGVcbiAgICogR2l0aHViIFdlYiBVSS4gVGhpcyBpcyB1c2VmdWwgZm9yIHN1cHBvcnRpbmcgbGFiZWxzIGxpa2UgYHRhcmdldDogZGV2ZWxvcG1lbnQtYnJhbmNoYC5cbiAgICpcbiAgICogQHRocm93cyB7SW52YWxpZFRhcmdldExhYmVsRXJyb3J9IEludmFsaWQgbGFiZWwgaGFzIGJlZW4gYXBwbGllZCB0byBwdWxsIHJlcXVlc3QuXG4gICAqIEB0aHJvd3Mge0ludmFsaWRUYXJnZXRCcmFuY2hFcnJvcn0gSW52YWxpZCBHaXRodWIgdGFyZ2V0IGJyYW5jaCBoYXMgYmVlbiBzZWxlY3RlZC5cbiAgICovXG4gIGJyYW5jaGVzOiBUYXJnZXRMYWJlbEJyYW5jaFJlc3VsdCB8ICgoZ2l0aHViVGFyZ2V0QnJhbmNoOiBzdHJpbmcpID0+IFRhcmdldExhYmVsQnJhbmNoUmVzdWx0KTtcbn1cblxuLyoqXG4gKiBDb25maWd1cmF0aW9uIGZvciB0aGUgbWVyZ2Ugc2NyaXB0IHdpdGggYWxsIHJlbW90ZSBvcHRpb25zIHNwZWNpZmllZC4gVGhlXG4gKiBkZWZhdWx0IGBNZXJnZUNvbmZpZ2AgaGFzIGRvZXMgbm90IHJlcXVpcmUgYW55IG9mIHRoZXNlIG9wdGlvbnMgYXMgZGVmYXVsdHNcbiAqIGFyZSBwcm92aWRlZCBieSB0aGUgY29tbW9uIGRldi1pbmZyYSBnaXRodWIgY29uZmlndXJhdGlvbi5cbiAqL1xuZXhwb3J0IHR5cGUgTWVyZ2VDb25maWdXaXRoUmVtb3RlID0gTWVyZ2VDb25maWcgJiB7cmVtb3RlOiBHaXRDbGllbnRDb25maWd9O1xuXG4vKiogQ29uZmlndXJhdGlvbiBmb3IgdGhlIG1lcmdlIHNjcmlwdC4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgTWVyZ2VDb25maWcge1xuICAvKipcbiAgICogQ29uZmlndXJhdGlvbiBmb3IgdGhlIHVwc3RyZWFtIHJlbW90ZS4gQWxsIG9mIHRoZXNlIG9wdGlvbnMgYXJlIG9wdGlvbmFsIGFzXG4gICAqIGRlZmF1bHRzIGFyZSBwcm92aWRlZCBieSB0aGUgY29tbW9uIGRldi1pbmZyYSBnaXRodWIgY29uZmlndXJhdGlvbi5cbiAgICovXG4gIHJlbW90ZT86IEdpdENsaWVudENvbmZpZztcbiAgLyoqIExpc3Qgb2YgdGFyZ2V0IGxhYmVscy4gKi9cbiAgbGFiZWxzOiBUYXJnZXRMYWJlbFtdO1xuICAvKiogUmVxdWlyZWQgYmFzZSBjb21taXRzIGZvciBnaXZlbiBicmFuY2hlcy4gKi9cbiAgcmVxdWlyZWRCYXNlQ29tbWl0cz86IHtbYnJhbmNoTmFtZTogc3RyaW5nXTogc3RyaW5nfTtcbiAgLyoqIFBhdHRlcm4gdGhhdCBtYXRjaGVzIGxhYmVscyB3aGljaCBpbXBseSBhIHNpZ25lZCBDTEEuICovXG4gIGNsYVNpZ25lZExhYmVsOiBzdHJpbmcgfCBSZWdFeHA7XG4gIC8qKiBQYXR0ZXJuIHRoYXQgbWF0Y2hlcyBsYWJlbHMgd2hpY2ggaW1wbHkgYSBtZXJnZSByZWFkeSBwdWxsIHJlcXVlc3QuICovXG4gIG1lcmdlUmVhZHlMYWJlbDogc3RyaW5nIHwgUmVnRXhwO1xuICAvKiogTGFiZWwgdGhhdCBpcyBhcHBsaWVkIHdoZW4gc3BlY2lhbCBhdHRlbnRpb24gZnJvbSB0aGUgY2FyZXRha2VyIGlzIHJlcXVpcmVkLiAqL1xuICBjYXJldGFrZXJOb3RlTGFiZWw/OiBzdHJpbmcgfCBSZWdFeHA7XG4gIC8qKiBMYWJlbCB3aGljaCBjYW4gYmUgYXBwbGllZCB0byBmaXh1cCBjb21taXQgbWVzc2FnZXMgaW4gdGhlIG1lcmdlIHNjcmlwdC4gKi9cbiAgY29tbWl0TWVzc2FnZUZpeHVwTGFiZWw6IHN0cmluZyB8IFJlZ0V4cDtcbiAgLyoqIExhYmVsIHRoYXQgaXMgYXBwbGllZCB3aGVuIGEgYnJlYWtpbmcgY2hhbmdlIGlzIG1hZGUgaW4gdGhlIHB1bGwgcmVxdWVzdC4gKi9cbiAgYnJlYWtpbmdDaGFuZ2VMYWJlbD86IHN0cmluZztcbiAgLyoqXG4gICAqIFdoZXRoZXIgcHVsbCByZXF1ZXN0cyBzaG91bGQgYmUgbWVyZ2VkIHVzaW5nIHRoZSBHaXRodWIgQVBJLiBUaGlzIGNhbiBiZSBlbmFibGVkXG4gICAqIGlmIHByb2plY3RzIHdhbnQgdG8gaGF2ZSB0aGVpciBwdWxsIHJlcXVlc3RzIHNob3cgdXAgYXMgYE1lcmdlZGAgaW4gdGhlIEdpdGh1YiBVSS5cbiAgICogVGhlIGRvd25zaWRlIGlzIHRoYXQgZml4dXAgb3Igc3F1YXNoIGNvbW1pdHMgbm8gbG9uZ2VyIHdvcmsgYXMgdGhlIEdpdGh1YiBBUEkgZG9lc1xuICAgKiBub3Qgc3VwcG9ydCB0aGlzLlxuICAgKi9cbiAgZ2l0aHViQXBpTWVyZ2U6IGZhbHNlIHwgR2l0aHViQXBpTWVyZ2VTdHJhdGVneUNvbmZpZztcbiAgLyoqXG4gICAqIExpc3Qgb2YgY29tbWl0IHNjb3BlcyB3aGljaCBhcmUgZXhlbXB0ZWQgZnJvbSB0YXJnZXQgbGFiZWwgY29udGVudCByZXF1aXJlbWVudHMuIGkuZS4gbm8gYGZlYXRgXG4gICAqIHNjb3BlcyBpbiBwYXRjaCBicmFuY2hlcywgbm8gYnJlYWtpbmcgY2hhbmdlcyBpbiBtaW5vciBvciBwYXRjaCBjaGFuZ2VzLlxuICAgKi9cbiAgdGFyZ2V0TGFiZWxFeGVtcHRTY29wZXM/OiBzdHJpbmdbXTtcbn1cblxuLyoqXG4gKiBDb25maWd1cmF0aW9uIG9mIHRoZSBtZXJnZSBzY3JpcHQgaW4gdGhlIGRldi1pbmZyYSBjb25maWd1cmF0aW9uLiBOb3RlIHRoYXQgdGhlXG4gKiBtZXJnZSBjb25maWd1cmF0aW9uIGlzIHJldHJpZXZlZCBsYXppbHkgYXMgdXN1YWxseSB0aGVzZSBjb25maWd1cmF0aW9ucyByZWx5XG4gKiBvbiBicmFuY2ggbmFtZSBjb21wdXRhdGlvbnMuIFdlIGRvbid0IHdhbnQgdG8gcnVuIHRoZXNlIGltbWVkaWF0ZWx5IHdoZW5ldmVyXG4gKiB0aGUgZGV2LWluZnJhIGNvbmZpZ3VyYXRpb24gaXMgbG9hZGVkIGFzIHRoYXQgY291bGQgc2xvdy1kb3duIG90aGVyIGNvbW1hbmRzLlxuICovXG5leHBvcnQgdHlwZSBEZXZJbmZyYU1lcmdlQ29uZmlnID0gTmdEZXZDb25maWc8e1xuICAnbWVyZ2UnOiAoYXBpOiBHaXRodWJDbGllbnQpID0+IE1lcmdlQ29uZmlnIHwgUHJvbWlzZTxNZXJnZUNvbmZpZz47XG59PjtcblxuLyoqIExvYWRzIGFuZCB2YWxpZGF0ZXMgdGhlIG1lcmdlIGNvbmZpZ3VyYXRpb24uICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9hZEFuZFZhbGlkYXRlQ29uZmlnKFxuICBjb25maWc6IFBhcnRpYWw8RGV2SW5mcmFNZXJnZUNvbmZpZz4sXG4gIGFwaTogR2l0aHViQ2xpZW50LFxuKTogUHJvbWlzZTx7Y29uZmlnPzogTWVyZ2VDb25maWc7IGVycm9ycz86IHN0cmluZ1tdfT4ge1xuICBpZiAoY29uZmlnLm1lcmdlID09PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4ge2Vycm9yczogWydObyBtZXJnZSBjb25maWd1cmF0aW9uIGZvdW5kLiBTZXQgdGhlIGBtZXJnZWAgY29uZmlndXJhdGlvbi4nXX07XG4gIH1cblxuICBpZiAodHlwZW9mIGNvbmZpZy5tZXJnZSAhPT0gJ2Z1bmN0aW9uJykge1xuICAgIHJldHVybiB7ZXJyb3JzOiBbJ0V4cGVjdGVkIG1lcmdlIGNvbmZpZ3VyYXRpb24gdG8gYmUgZGVmaW5lZCBsYXppbHkgdGhyb3VnaCBhIGZ1bmN0aW9uLiddfTtcbiAgfVxuXG4gIGNvbnN0IG1lcmdlQ29uZmlnID0gYXdhaXQgY29uZmlnLm1lcmdlKGFwaSk7XG4gIGNvbnN0IGVycm9ycyA9IHZhbGlkYXRlTWVyZ2VDb25maWcobWVyZ2VDb25maWcpO1xuXG4gIGlmIChlcnJvcnMubGVuZ3RoKSB7XG4gICAgcmV0dXJuIHtlcnJvcnN9O1xuICB9XG5cbiAgcmV0dXJuIHtjb25maWc6IG1lcmdlQ29uZmlnfTtcbn1cblxuLyoqIFZhbGlkYXRlcyB0aGUgc3BlY2lmaWVkIGNvbmZpZ3VyYXRpb24uIFJldHVybnMgYSBsaXN0IG9mIGZhaWx1cmUgbWVzc2FnZXMuICovXG5mdW5jdGlvbiB2YWxpZGF0ZU1lcmdlQ29uZmlnKGNvbmZpZzogUGFydGlhbDxNZXJnZUNvbmZpZz4pOiBzdHJpbmdbXSB7XG4gIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcbiAgaWYgKCFjb25maWcubGFiZWxzKSB7XG4gICAgZXJyb3JzLnB1c2goJ05vIGxhYmVsIGNvbmZpZ3VyYXRpb24uJyk7XG4gIH0gZWxzZSBpZiAoIUFycmF5LmlzQXJyYXkoY29uZmlnLmxhYmVscykpIHtcbiAgICBlcnJvcnMucHVzaCgnTGFiZWwgY29uZmlndXJhdGlvbiBuZWVkcyB0byBiZSBhbiBhcnJheS4nKTtcbiAgfVxuICBpZiAoIWNvbmZpZy5jbGFTaWduZWRMYWJlbCkge1xuICAgIGVycm9ycy5wdXNoKCdObyBDTEEgc2lnbmVkIGxhYmVsIGNvbmZpZ3VyZWQuJyk7XG4gIH1cbiAgaWYgKCFjb25maWcubWVyZ2VSZWFkeUxhYmVsKSB7XG4gICAgZXJyb3JzLnB1c2goJ05vIG1lcmdlIHJlYWR5IGxhYmVsIGNvbmZpZ3VyZWQuJyk7XG4gIH1cbiAgaWYgKGNvbmZpZy5naXRodWJBcGlNZXJnZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgZXJyb3JzLnB1c2goJ05vIGV4cGxpY2l0IGNob2ljZSBvZiBtZXJnZSBzdHJhdGVneS4gUGxlYXNlIHNldCBgZ2l0aHViQXBpTWVyZ2VgLicpO1xuICB9XG4gIHJldHVybiBlcnJvcnM7XG59XG4iXX0=