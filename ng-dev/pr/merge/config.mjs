"use strict";
/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.loadAndValidateConfig = void 0;
/** Loads and validates the merge configuration. */
async function loadAndValidateConfig(config, api) {
    if (config.merge === undefined) {
        return { errors: ['No merge configuration found. Set the `merge` configuration.'] };
    }
    if (typeof config.merge !== 'function') {
        return { errors: ['Expected merge configuration to be defined lazily through a function.'] };
    }
    const mergeConfig = await config.merge(api);
    const errors = validateMergeConfig(mergeConfig);
    if (errors.length) {
        return { errors };
    }
    return { config: mergeConfig };
}
exports.loadAndValidateConfig = loadAndValidateConfig;
/** Validates the specified configuration. Returns a list of failure messages. */
function validateMergeConfig(config) {
    const errors = [];
    if (!config.labels) {
        errors.push('No label configuration.');
    }
    else if (!Array.isArray(config.labels)) {
        errors.push('Label configuration needs to be an array.');
    }
    if (!config.claSignedLabel) {
        errors.push('No CLA signed label configured.');
    }
    if (!config.mergeReadyLabel) {
        errors.push('No merge ready label configured.');
    }
    if (config.githubApiMerge === undefined) {
        errors.push('No explicit choice of merge strategy. Please set `githubApiMerge`.');
    }
    return errors;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vbmctZGV2L3ByL21lcmdlL2NvbmZpZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7OztHQU1HOzs7QUFxRkgsbURBQW1EO0FBQzVDLEtBQUssVUFBVSxxQkFBcUIsQ0FDekMsTUFBb0MsRUFDcEMsR0FBaUI7SUFFakIsSUFBSSxNQUFNLENBQUMsS0FBSyxLQUFLLFNBQVMsRUFBRTtRQUM5QixPQUFPLEVBQUMsTUFBTSxFQUFFLENBQUMsOERBQThELENBQUMsRUFBQyxDQUFDO0tBQ25GO0lBRUQsSUFBSSxPQUFPLE1BQU0sQ0FBQyxLQUFLLEtBQUssVUFBVSxFQUFFO1FBQ3RDLE9BQU8sRUFBQyxNQUFNLEVBQUUsQ0FBQyx1RUFBdUUsQ0FBQyxFQUFDLENBQUM7S0FDNUY7SUFFRCxNQUFNLFdBQVcsR0FBRyxNQUFNLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDNUMsTUFBTSxNQUFNLEdBQUcsbUJBQW1CLENBQUMsV0FBVyxDQUFDLENBQUM7SUFFaEQsSUFBSSxNQUFNLENBQUMsTUFBTSxFQUFFO1FBQ2pCLE9BQU8sRUFBQyxNQUFNLEVBQUMsQ0FBQztLQUNqQjtJQUVELE9BQU8sRUFBQyxNQUFNLEVBQUUsV0FBVyxFQUFDLENBQUM7QUFDL0IsQ0FBQztBQXBCRCxzREFvQkM7QUFFRCxpRkFBaUY7QUFDakYsU0FBUyxtQkFBbUIsQ0FBQyxNQUE0QjtJQUN2RCxNQUFNLE1BQU0sR0FBYSxFQUFFLENBQUM7SUFDNUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUU7UUFDbEIsTUFBTSxDQUFDLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO0tBQ3hDO1NBQU0sSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFO1FBQ3hDLE1BQU0sQ0FBQyxJQUFJLENBQUMsMkNBQTJDLENBQUMsQ0FBQztLQUMxRDtJQUNELElBQUksQ0FBQyxNQUFNLENBQUMsY0FBYyxFQUFFO1FBQzFCLE1BQU0sQ0FBQyxJQUFJLENBQUMsaUNBQWlDLENBQUMsQ0FBQztLQUNoRDtJQUNELElBQUksQ0FBQyxNQUFNLENBQUMsZUFBZSxFQUFFO1FBQzNCLE1BQU0sQ0FBQyxJQUFJLENBQUMsa0NBQWtDLENBQUMsQ0FBQztLQUNqRDtJQUNELElBQUksTUFBTSxDQUFDLGNBQWMsS0FBSyxTQUFTLEVBQUU7UUFDdkMsTUFBTSxDQUFDLElBQUksQ0FBQyxvRUFBb0UsQ0FBQyxDQUFDO0tBQ25GO0lBQ0QsT0FBTyxNQUFNLENBQUM7QUFDaEIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBHb29nbGUgTExDIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYW4gTUlULXN0eWxlIGxpY2Vuc2UgdGhhdCBjYW4gYmVcbiAqIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUgYXQgaHR0cHM6Ly9hbmd1bGFyLmlvL2xpY2Vuc2VcbiAqL1xuXG5pbXBvcnQge0dpdGh1YkNvbmZpZ30gZnJvbSAnLi4vLi4vdXRpbHMvY29uZmlnJztcbmltcG9ydCB7R2l0aHViQ2xpZW50fSBmcm9tICcuLi8uLi91dGlscy9naXQvZ2l0aHViJztcblxuaW1wb3J0IHtHaXRodWJBcGlNZXJnZVN0cmF0ZWd5Q29uZmlnfSBmcm9tICcuL3N0cmF0ZWdpZXMvYXBpLW1lcmdlJztcblxuLyoqIERlc2NyaWJlcyBwb3NzaWJsZSB2YWx1ZXMgdGhhdCBjYW4gYmUgcmV0dXJuZWQgZm9yIGBicmFuY2hlc2Agb2YgYSB0YXJnZXQgbGFiZWwuICovXG5leHBvcnQgdHlwZSBUYXJnZXRMYWJlbEJyYW5jaFJlc3VsdCA9IHN0cmluZ1tdIHwgUHJvbWlzZTxzdHJpbmdbXT47XG5cbi8qKlxuICogUG9zc2libGUgbWVyZ2UgbWV0aG9kcyBzdXBwb3J0ZWQgYnkgdGhlIEdpdGh1YiBBUEkuXG4gKiBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3YzL3B1bGxzLyNtZXJnZS1hLXB1bGwtcmVxdWVzdC1tZXJnZS1idXR0b24uXG4gKi9cbmV4cG9ydCB0eXBlIEdpdGh1YkFwaU1lcmdlTWV0aG9kID0gJ21lcmdlJyB8ICdzcXVhc2gnIHwgJ3JlYmFzZSc7XG5cbi8qKlxuICogVGFyZ2V0IGxhYmVscyByZXByZXNlbnQgR2l0aHViIHB1bGwgcmVxdWVzdHMgbGFiZWxzLiBUaGVzZSBsYWJlbHMgaW5zdHJ1Y3QgdGhlIG1lcmdlXG4gKiBzY3JpcHQgaW50byB3aGljaCBicmFuY2hlcyBhIGdpdmVuIHB1bGwgcmVxdWVzdCBzaG91bGQgYmUgbWVyZ2VkIHRvLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFRhcmdldExhYmVsIHtcbiAgLyoqIFBhdHRlcm4gdGhhdCBtYXRjaGVzIHRoZSBnaXZlbiB0YXJnZXQgbGFiZWwuICovXG4gIHBhdHRlcm46IFJlZ0V4cCB8IHN0cmluZztcbiAgLyoqXG4gICAqIExpc3Qgb2YgYnJhbmNoZXMgYSBwdWxsIHJlcXVlc3Qgd2l0aCB0aGlzIHRhcmdldCBsYWJlbCBzaG91bGQgYmUgbWVyZ2VkIGludG8uXG4gICAqIENhbiBhbHNvIGJlIHdyYXBwZWQgaW4gYSBmdW5jdGlvbiB0aGF0IGFjY2VwdHMgdGhlIHRhcmdldCBicmFuY2ggc3BlY2lmaWVkIGluIHRoZVxuICAgKiBHaXRodWIgV2ViIFVJLiBUaGlzIGlzIHVzZWZ1bCBmb3Igc3VwcG9ydGluZyBsYWJlbHMgbGlrZSBgdGFyZ2V0OiBkZXZlbG9wbWVudC1icmFuY2hgLlxuICAgKlxuICAgKiBAdGhyb3dzIHtJbnZhbGlkVGFyZ2V0TGFiZWxFcnJvcn0gSW52YWxpZCBsYWJlbCBoYXMgYmVlbiBhcHBsaWVkIHRvIHB1bGwgcmVxdWVzdC5cbiAgICogQHRocm93cyB7SW52YWxpZFRhcmdldEJyYW5jaEVycm9yfSBJbnZhbGlkIEdpdGh1YiB0YXJnZXQgYnJhbmNoIGhhcyBiZWVuIHNlbGVjdGVkLlxuICAgKi9cbiAgYnJhbmNoZXM6IFRhcmdldExhYmVsQnJhbmNoUmVzdWx0IHwgKChnaXRodWJUYXJnZXRCcmFuY2g6IHN0cmluZykgPT4gVGFyZ2V0TGFiZWxCcmFuY2hSZXN1bHQpO1xufVxuXG4vKipcbiAqIENvbmZpZ3VyYXRpb24gZm9yIHRoZSBtZXJnZSBzY3JpcHQgd2l0aCBhbGwgcmVtb3RlIG9wdGlvbnMgc3BlY2lmaWVkLiBUaGVcbiAqIGRlZmF1bHQgYE1lcmdlQ29uZmlnYCBoYXMgZG9lcyBub3QgcmVxdWlyZSBhbnkgb2YgdGhlc2Ugb3B0aW9ucyBhcyBkZWZhdWx0c1xuICogYXJlIHByb3ZpZGVkIGJ5IHRoZSBjb21tb24gZGV2LWluZnJhIGdpdGh1YiBjb25maWd1cmF0aW9uLlxuICovXG5leHBvcnQgdHlwZSBNZXJnZUNvbmZpZ1dpdGhSZW1vdGUgPSBNZXJnZUNvbmZpZyAmIHtyZW1vdGU6IEdpdGh1YkNvbmZpZ307XG5cbi8qKiBDb25maWd1cmF0aW9uIGZvciB0aGUgbWVyZ2Ugc2NyaXB0LiAqL1xuZXhwb3J0IGludGVyZmFjZSBNZXJnZUNvbmZpZyB7XG4gIC8qKlxuICAgKiBDb25maWd1cmF0aW9uIGZvciB0aGUgdXBzdHJlYW0gcmVtb3RlLiBBbGwgb2YgdGhlc2Ugb3B0aW9ucyBhcmUgb3B0aW9uYWwgYXNcbiAgICogZGVmYXVsdHMgYXJlIHByb3ZpZGVkIGJ5IHRoZSBjb21tb24gZGV2LWluZnJhIGdpdGh1YiBjb25maWd1cmF0aW9uLlxuICAgKi9cbiAgcmVtb3RlPzogR2l0aHViQ29uZmlnO1xuICAvKiogTGlzdCBvZiB0YXJnZXQgbGFiZWxzLiAqL1xuICBsYWJlbHM6IFRhcmdldExhYmVsW107XG4gIC8qKiBSZXF1aXJlZCBiYXNlIGNvbW1pdHMgZm9yIGdpdmVuIGJyYW5jaGVzLiAqL1xuICByZXF1aXJlZEJhc2VDb21taXRzPzoge1ticmFuY2hOYW1lOiBzdHJpbmddOiBzdHJpbmd9O1xuICAvKiogUGF0dGVybiB0aGF0IG1hdGNoZXMgbGFiZWxzIHdoaWNoIGltcGx5IGEgc2lnbmVkIENMQS4gKi9cbiAgY2xhU2lnbmVkTGFiZWw6IHN0cmluZyB8IFJlZ0V4cDtcbiAgLyoqIFBhdHRlcm4gdGhhdCBtYXRjaGVzIGxhYmVscyB3aGljaCBpbXBseSBhIG1lcmdlIHJlYWR5IHB1bGwgcmVxdWVzdC4gKi9cbiAgbWVyZ2VSZWFkeUxhYmVsOiBzdHJpbmcgfCBSZWdFeHA7XG4gIC8qKiBMYWJlbCB0aGF0IGlzIGFwcGxpZWQgd2hlbiBzcGVjaWFsIGF0dGVudGlvbiBmcm9tIHRoZSBjYXJldGFrZXIgaXMgcmVxdWlyZWQuICovXG4gIGNhcmV0YWtlck5vdGVMYWJlbD86IHN0cmluZyB8IFJlZ0V4cDtcbiAgLyoqIExhYmVsIHdoaWNoIGNhbiBiZSBhcHBsaWVkIHRvIGZpeHVwIGNvbW1pdCBtZXNzYWdlcyBpbiB0aGUgbWVyZ2Ugc2NyaXB0LiAqL1xuICBjb21taXRNZXNzYWdlRml4dXBMYWJlbDogc3RyaW5nIHwgUmVnRXhwO1xuICAvKipcbiAgICogV2hldGhlciBwdWxsIHJlcXVlc3RzIHNob3VsZCBiZSBtZXJnZWQgdXNpbmcgdGhlIEdpdGh1YiBBUEkuIFRoaXMgY2FuIGJlIGVuYWJsZWRcbiAgICogaWYgcHJvamVjdHMgd2FudCB0byBoYXZlIHRoZWlyIHB1bGwgcmVxdWVzdHMgc2hvdyB1cCBhcyBgTWVyZ2VkYCBpbiB0aGUgR2l0aHViIFVJLlxuICAgKiBUaGUgZG93bnNpZGUgaXMgdGhhdCBmaXh1cCBvciBzcXVhc2ggY29tbWl0cyBubyBsb25nZXIgd29yayBhcyB0aGUgR2l0aHViIEFQSSBkb2VzXG4gICAqIG5vdCBzdXBwb3J0IHRoaXMuXG4gICAqL1xuICBnaXRodWJBcGlNZXJnZTogZmFsc2UgfCBHaXRodWJBcGlNZXJnZVN0cmF0ZWd5Q29uZmlnO1xuICAvKipcbiAgICogTGlzdCBvZiBjb21taXQgc2NvcGVzIHdoaWNoIGFyZSBleGVtcHRlZCBmcm9tIHRhcmdldCBsYWJlbCBjb250ZW50IHJlcXVpcmVtZW50cy4gaS5lLiBubyBgZmVhdGBcbiAgICogc2NvcGVzIGluIHBhdGNoIGJyYW5jaGVzLCBubyBicmVha2luZyBjaGFuZ2VzIGluIG1pbm9yIG9yIHBhdGNoIGNoYW5nZXMuXG4gICAqL1xuICB0YXJnZXRMYWJlbEV4ZW1wdFNjb3Blcz86IHN0cmluZ1tdO1xufVxuXG4vKipcbiAqIENvbmZpZ3VyYXRpb24gb2YgdGhlIG1lcmdlIHNjcmlwdCBpbiB0aGUgZGV2LWluZnJhIGNvbmZpZ3VyYXRpb24uIE5vdGUgdGhhdCB0aGVcbiAqIG1lcmdlIGNvbmZpZ3VyYXRpb24gaXMgcmV0cmlldmVkIGxhemlseSBhcyB1c3VhbGx5IHRoZXNlIGNvbmZpZ3VyYXRpb25zIHJlbHlcbiAqIG9uIGJyYW5jaCBuYW1lIGNvbXB1dGF0aW9ucy4gV2UgZG9uJ3Qgd2FudCB0byBydW4gdGhlc2UgaW1tZWRpYXRlbHkgd2hlbmV2ZXJcbiAqIHRoZSBkZXYtaW5mcmEgY29uZmlndXJhdGlvbiBpcyBsb2FkZWQgYXMgdGhhdCBjb3VsZCBzbG93LWRvd24gb3RoZXIgY29tbWFuZHMuXG4gKi9cbmV4cG9ydCB0eXBlIERldkluZnJhTWVyZ2VDb25maWcgPSB7XG4gIGdpdGh1YjogR2l0aHViQ29uZmlnO1xuICBtZXJnZTogKGFwaTogR2l0aHViQ2xpZW50KSA9PiBNZXJnZUNvbmZpZyB8IFByb21pc2U8TWVyZ2VDb25maWc+O1xufTtcblxuLyoqIExvYWRzIGFuZCB2YWxpZGF0ZXMgdGhlIG1lcmdlIGNvbmZpZ3VyYXRpb24uICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9hZEFuZFZhbGlkYXRlQ29uZmlnKFxuICBjb25maWc6IFBhcnRpYWw8RGV2SW5mcmFNZXJnZUNvbmZpZz4sXG4gIGFwaTogR2l0aHViQ2xpZW50LFxuKTogUHJvbWlzZTx7Y29uZmlnPzogTWVyZ2VDb25maWc7IGVycm9ycz86IHN0cmluZ1tdfT4ge1xuICBpZiAoY29uZmlnLm1lcmdlID09PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4ge2Vycm9yczogWydObyBtZXJnZSBjb25maWd1cmF0aW9uIGZvdW5kLiBTZXQgdGhlIGBtZXJnZWAgY29uZmlndXJhdGlvbi4nXX07XG4gIH1cblxuICBpZiAodHlwZW9mIGNvbmZpZy5tZXJnZSAhPT0gJ2Z1bmN0aW9uJykge1xuICAgIHJldHVybiB7ZXJyb3JzOiBbJ0V4cGVjdGVkIG1lcmdlIGNvbmZpZ3VyYXRpb24gdG8gYmUgZGVmaW5lZCBsYXppbHkgdGhyb3VnaCBhIGZ1bmN0aW9uLiddfTtcbiAgfVxuXG4gIGNvbnN0IG1lcmdlQ29uZmlnID0gYXdhaXQgY29uZmlnLm1lcmdlKGFwaSk7XG4gIGNvbnN0IGVycm9ycyA9IHZhbGlkYXRlTWVyZ2VDb25maWcobWVyZ2VDb25maWcpO1xuXG4gIGlmIChlcnJvcnMubGVuZ3RoKSB7XG4gICAgcmV0dXJuIHtlcnJvcnN9O1xuICB9XG5cbiAgcmV0dXJuIHtjb25maWc6IG1lcmdlQ29uZmlnfTtcbn1cblxuLyoqIFZhbGlkYXRlcyB0aGUgc3BlY2lmaWVkIGNvbmZpZ3VyYXRpb24uIFJldHVybnMgYSBsaXN0IG9mIGZhaWx1cmUgbWVzc2FnZXMuICovXG5mdW5jdGlvbiB2YWxpZGF0ZU1lcmdlQ29uZmlnKGNvbmZpZzogUGFydGlhbDxNZXJnZUNvbmZpZz4pOiBzdHJpbmdbXSB7XG4gIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcbiAgaWYgKCFjb25maWcubGFiZWxzKSB7XG4gICAgZXJyb3JzLnB1c2goJ05vIGxhYmVsIGNvbmZpZ3VyYXRpb24uJyk7XG4gIH0gZWxzZSBpZiAoIUFycmF5LmlzQXJyYXkoY29uZmlnLmxhYmVscykpIHtcbiAgICBlcnJvcnMucHVzaCgnTGFiZWwgY29uZmlndXJhdGlvbiBuZWVkcyB0byBiZSBhbiBhcnJheS4nKTtcbiAgfVxuICBpZiAoIWNvbmZpZy5jbGFTaWduZWRMYWJlbCkge1xuICAgIGVycm9ycy5wdXNoKCdObyBDTEEgc2lnbmVkIGxhYmVsIGNvbmZpZ3VyZWQuJyk7XG4gIH1cbiAgaWYgKCFjb25maWcubWVyZ2VSZWFkeUxhYmVsKSB7XG4gICAgZXJyb3JzLnB1c2goJ05vIG1lcmdlIHJlYWR5IGxhYmVsIGNvbmZpZ3VyZWQuJyk7XG4gIH1cbiAgaWYgKGNvbmZpZy5naXRodWJBcGlNZXJnZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgZXJyb3JzLnB1c2goJ05vIGV4cGxpY2l0IGNob2ljZSBvZiBtZXJnZSBzdHJhdGVneS4gUGxlYXNlIHNldCBgZ2l0aHViQXBpTWVyZ2VgLicpO1xuICB9XG4gIHJldHVybiBlcnJvcnM7XG59XG4iXX0=